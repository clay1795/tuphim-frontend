<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend API</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #1a1a1a; 
            color: white; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #333; 
            border-radius: 8px; 
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .loading { color: #fbbf24; }
        .movie-item { 
            margin: 10px 0; 
            padding: 10px; 
            background: #333; 
            border-radius: 4px; 
        }
        .movie-poster { 
            width: 60px; 
            height: 80px; 
            object-fit: cover; 
            border-radius: 4px; 
            margin-right: 10px; 
            float: left; 
        }
        .movie-info { 
            margin-left: 80px; 
        }
        .movie-title { 
            font-weight: bold; 
            color: #60a5fa; 
        }
        .movie-year { 
            color: #9ca3af; 
        }
    </style>
</head>
<body>
    <h1>üé¨ Test Frontend API - TupPhim</h1>
    
    <div class="test-section">
        <h2>üì° API Connection Test</h2>
        <button onclick="testAPI()">Test API Connection</button>
        <div id="api-status"></div>
    </div>
    
    <div class="test-section">
        <h2>üéØ Top 6 Movies Test</h2>
        <button onclick="loadTopMovies()">Load Top 6 Movies</button>
        <div id="top-movies"></div>
    </div>
    
    <div class="test-section">
        <h2>‚≠ê Featured Movies Test</h2>
        <button onclick="loadFeaturedMovies()">Load Featured Movies</button>
        <div id="featured-movies"></div>
    </div>
    
    <div class="test-section">
        <h2>üìä MongoDB Stats</h2>
        <button onclick="loadStats()">Load Stats</button>
        <div id="stats"></div>
    </div>

    <script>
        const API_BASE = 'https://33ss6xpk-3001.asse.devtunnels.ms/api';
        
        async function testAPI() {
            const statusDiv = document.getElementById('api-status');
            statusDiv.innerHTML = '<span class="loading">Testing API connection...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/mongo-movies/stats`);
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.innerHTML = `<span class="success">‚úÖ API Connected! Movies: ${data.data.totalMovies}</span>`;
                } else {
                    statusDiv.innerHTML = `<span class="error">‚ùå API Error: ${data.message}</span>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">‚ùå Connection Error: ${error.message}</span>`;
            }
        }
        
        async function loadTopMovies() {
            const moviesDiv = document.getElementById('top-movies');
            moviesDiv.innerHTML = '<span class="loading">Loading top 6 movies...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/mongo-movies/new?page=1&limit=6`);
                const data = await response.json();
                
                if (data.success && data.data.items) {
                    const movies = data.data.items;
                    moviesDiv.innerHTML = `
                        <div class="success">‚úÖ Loaded ${movies.length} movies</div>
                        ${movies.map((movie, index) => `
                            <div class="movie-item">
                                <img src="${movie.poster_url || movie.thumb_url}" class="movie-poster" alt="${movie.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA2MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjMwIiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBJbWFnZTwvdGV4dD4KPC9zdmc+'">
                                <div class="movie-info">
                                    <div class="movie-title">${index + 1}. ${movie.name}</div>
                                    <div class="movie-year">${movie.year || 'N/A'} ‚Ä¢ ${movie.type || 'N/A'}</div>
                                    <div>${movie.episode_current || 'N/A'}</div>
                                </div>
                                <div style="clear: both;"></div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    moviesDiv.innerHTML = '<span class="error">‚ùå No movies found</span>';
                }
            } catch (error) {
                moviesDiv.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        async function loadFeaturedMovies() {
            const moviesDiv = document.getElementById('featured-movies');
            moviesDiv.innerHTML = '<span class="loading">Loading featured movies...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/mongo-movies/new?page=1&limit=24`);
                const data = await response.json();
                
                if (data.success && data.data.items) {
                    const movies = data.data.items;
                    moviesDiv.innerHTML = `
                        <div class="success">‚úÖ Loaded ${movies.length} featured movies</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            ${movies.slice(0, 12).map(movie => `
                                <div style="background: #333; padding: 10px; border-radius: 8px;">
                                    <img src="${movie.poster_url || movie.thumb_url}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;" alt="${movie.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPg=='">
                                    <div style="margin-top: 8px;">
                                        <div style="font-weight: bold; color: #60a5fa; font-size: 12px;">${movie.name}</div>
                                        <div style="color: #9ca3af; font-size: 10px;">${movie.year || 'N/A'}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    moviesDiv.innerHTML = '<span class="error">‚ùå No featured movies found</span>';
                }
            } catch (error) {
                moviesDiv.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        async function loadStats() {
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = '<span class="loading">Loading stats...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/mongo-movies/stats`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const stats = data.data;
                    statsDiv.innerHTML = `
                        <div class="success">‚úÖ MongoDB Stats Loaded</div>
                        <div style="margin-top: 10px;">
                            <div><strong>Total Movies:</strong> ${stats.totalMovies}</div>
                            <div><strong>By Type:</strong> ${stats.byType ? stats.byType.map(t => `${t._id}: ${t.count}`).join(', ') : 'N/A'}</div>
                            <div><strong>Top Years:</strong> ${stats.topYears ? stats.topYears.slice(0, 5).map(y => `${y._id}: ${y.count}`).join(', ') : 'N/A'}</div>
                            <div><strong>Last Sync:</strong> ${stats.lastSync || 'N/A'}</div>
                        </div>
                    `;
                } else {
                    statsDiv.innerHTML = '<span class="error">‚ùå No stats found</span>';
                }
            } catch (error) {
                statsDiv.innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        // Auto-test on load
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
