# 🔧 Hướng Dẫn Khắc Phục Tunnel API Connection

## ✅ Vấn đề đã được giải quyết!

**Vấn đề**: Frontend đang cố gắng gọi API đến `http://localhost:3001` thay vì sử dụng tunnel URL, gây ra CORS errors và không hiển thị phim.

**Giải pháp**: Cấu hình API URL động để tự động detect tunnel environment.

## 🎯 Những gì đã được cập nhật:

### 1. **API Configuration Dynamic** (`src/config/apiConfig.js`)
- Tự động detect tunnel environment
- Sử dụng tunnel URL khi chạy qua VS Code Port Forwarding
- Fallback về localhost khi chạy local

### 2. **Updated Files**:
- ✅ `src/App.jsx` - API calls cho homepage movies
- ✅ `src/context/AuthContextSimple.jsx` - User authentication APIs
- ✅ `src/services/simpleMovieApi.js` - Movie API services
- ✅ `src/services/mongoMovieApi.js` - MongoDB API services
- ✅ `src/services/instantSearchApi.js` - Search API services
- ✅ `src/services/movieApi.js` - Main movie API services
- ✅ `src/components/Banner.jsx` - Featured movies
- ✅ `src/components/MovieDetailTest.jsx` - Movie detail testing

## 🚀 Cách sử dụng:

### **Bước 1: Restart Frontend Server**
```bash
# Dừng frontend server hiện tại (Ctrl+C)
# Chạy lại với cấu hình mới
npm run dev:host
```

### **Bước 2: Kiểm tra Console**
Mở browser DevTools Console, bạn sẽ thấy:
```
🔧 API Configuration: {
  baseUrl: "https://33ss6xpk-3001.asse.devtunnels.ms/api",
  isTunnel: true,
  tunnelBackendUrl: "https://33ss6xpk-3001.asse.devtunnels.ms",
  currentOrigin: "https://33ss6xpk-5173.asse.devtunnels.ms"
}
```

### **Bước 3: Test API Connection**
```bash
# Chạy test script
node test-api-connection.cjs
```

## 🎉 Kết quả mong đợi:

### ✅ **Phim sẽ hiển thị đầy đủ**:
- ✅ "Phim đề xuất chính" section
- ✅ "Top6 phim" section  
- ✅ Featured movies trong banner
- ✅ Suggested movies
- ✅ Tất cả movie sections

### ✅ **Không ảnh hưởng localhost**:
- ✅ Localhost vẫn hoạt động bình thường
- ✅ Cấu hình tự động detect environment
- ✅ Không cần thay đổi code khi switch giữa localhost và tunnel

### ✅ **Mobile access hoạt động**:
- ✅ Truy cập từ mobile: `https://33ss6xpk-5173.asse.devtunnels.ms/`
- ✅ Tất cả tính năng hoạt động đầy đủ
- ✅ Database MongoDB kết nối bình thường

## 🔍 Debugging:

### **Nếu vẫn có vấn đề**:

1. **Kiểm tra Console Logs**:
   - Mở DevTools Console
   - Tìm message "🔧 API Configuration"
   - Đảm bảo `isTunnel: true` và `baseUrl` có tunnel domain

2. **Kiểm tra Network Tab**:
   - Mở DevTools Network tab
   - Tìm API calls đến `/api/movies/new` hoặc `/api/mongo-movies/new`
   - Đảm bảo URLs có tunnel domain, không phải localhost

3. **Test API trực tiếp**:
   ```bash
   # Test backend tunnel URL
   curl https://33ss6xpk-3001.asse.devtunnels.ms/api/health
   
   # Test movies API
   curl https://33ss6xpk-3001.asse.devtunnels.ms/api/mongo-movies/new?page=1&limit=24
   ```

## 📱 URLs hiện tại:
- **Frontend**: https://33ss6xpk-5173.asse.devtunnels.ms/
- **Backend**: https://33ss6xpk-3001.asse.devtunnels.ms/

## 🎯 Tính năng đã hoạt động:
- ✅ **Homepage movies** - Phim mới cập nhật
- ✅ **Featured movies** - Phim nổi bật trong banner
- ✅ **Suggested movies** - Phim đề xuất
- ✅ **Search functionality** - Tìm kiếm phim
- ✅ **User authentication** - Đăng ký/đăng nhập
- ✅ **Favorites & History** - Yêu thích và lịch sử
- ✅ **Movie details** - Chi tiết phim
- ✅ **MongoDB integration** - Kết nối database

Bây giờ website sẽ hiển thị đầy đủ phim từ MongoDB và hoạt động hoàn hảo trên cả PC và mobile! 🚀📱
