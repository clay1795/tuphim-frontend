# Backend Setup cho TupPhim với External API

## 1. Tạo Backend Server (Node.js + Express)

```bash
# Tạo thư mục backend
mkdir tuphim-backend
cd tuphim-backend

# Khởi tạo project
npm init -y

# Install dependencies
npm install express mongoose cors helmet bcryptjs jsonwebtoken express-rate-limit redis
npm install -D nodemon

# Tạo cấu trúc thư mục
mkdir src
mkdir src/controllers
mkdir src/models
mkdir src/routes
mkdir src/middleware
mkdir src/utils
```

## 2. Cấu trúc Backend

```
tuphim-backend/
├── src/
│   ├── controllers/
│   │   ├── authController.js
│   │   └── userController.js
│   ├── models/
│   │   └── User.js
│   ├── routes/
│   │   ├── auth.js
│   │   └── users.js
│   ├── middleware/
│   │   ├── auth.js
│   │   └── rateLimiter.js
│   ├── utils/
│   │   └── apiCache.js
│   └── server.js
├── package.json
└── .env
```

## 3. Database Schema (Chỉ lưu User Data)

```javascript
// User Model
const userSchema = {
  email: String,
  password: String, // hashed
  username: String,
  fullName: String,
  role: String, // 'user', 'admin'
  preferences: {
    favoriteGenres: [String],
    watchHistory: [String],
    watchlist: [String]
  },
  createdAt: Date,
  lastLogin: Date
}
```

## 4. API Endpoints

```javascript
// Authentication
POST /api/auth/register
POST /api/auth/login
POST /api/auth/logout
GET  /api/auth/me

// User Management
GET    /api/users/profile
PUT    /api/users/profile
GET    /api/users/watchlist
POST   /api/users/watchlist
DELETE /api/users/watchlist/:movieId
GET    /api/users/history
```

## 5. External API Proxy

```javascript
// Proxy external API calls với caching
GET /api/movies/search?q=keyword
GET /api/movies/detail/:slug
GET /api/movies/categories
GET /api/movies/trending
```
